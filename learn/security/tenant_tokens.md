# Tenant tokens

When developing complex applications or handling sensitive data, the control over security and permissions offered by API keys might not be enough. This is where tenant tokens and multitenancy come in.

In this guide you'll first learn what multitenancy is, how tenant tokens solve it. Then, you'll see how to generate and use tokens using one of our official SDKs or from scratch.

## What is multitenancy?

[2-3 sentences on general application of multinenancy]

[2-3 sentences on application of multitenancy in meilisearch]

[1-2 sentences introducing an example case: medical records]

### What are tenant tokens and how do they solve multitenancy in Meilisearch?

[briefly describe how meilisearch uses tenant tokens to address multitenancy]

[wrap up description with an overview of how this would work with the example case]


## Generating tenant tokens

There are no specific instance options or index settings required to activate tenant tokens. Any publicly available API endpoint that can be accessed with an API key will seamlessly accept a valid tenant token.

The quickest method to generate tenant tokens is using one of our official SDKs. Using an SDK is our recommended method for token generation, so this guide will cover that scenario first. It is also possible to generate the token from scratch.

### Tenant token anatomy

A tenant token is made ouf of two parts: header and payload.
#### Token header
The header must specify that this is a JWT token. Meilisearch does not currently accept any other types of tokens.

The header must also specify which encryption algorithm has been used to protect the token. Meilisearch currently accepts three algorithms:

- `HS256`
- `HS384`
- `HS512`

#### Token payload

The payload contains three fields: `apiKeyPrefix`, `exp`, and `searchRules`.

- `apiKeyPrefix` is a string contain the first 8 characters of a valid Meilisearch API key;
- `exp` sets the token expiry date, represented in UNIX epoch;
- `searchRules` contains a set of rules that will be enforced to any queries using this token

#### Search rules

[Overview of search rules syntax]

### Generating tenant tokens with an SDK

[interview integrations team to understand the design of the helper functions]

### Using tenant tokens

[continue describing example scenario]

[add curl code sample with a query using a tenant token]


### Generating tenant tokens from scratch

Though token generation with an SDK is preferred, you may prefer to generate tenant tokens without them.

```javascript
const meiliSearchApikey = '[an_api_key]';

let header = {
  "alg": "HS256",
  "typ": "JWT"
}

const base64Header = base64Encode(header);

let payload = {
    "apiKeyPrefix": meiliSearchApiKey.slice(0,8),
    "exp": 1641835850,
    "searchRules": {
        "*": {
            "filter": "user_id = 1"
        }
    }
}

const base64Payload = base64Encode(payload);

let signature = HS256(base64Header + '.' + base64Payload, meiliSearchApiKey);

let tenantToken = base64Header + '.' + base64Payload + '.' + signature;
```

Once you have created the tenant token from scratch, you [can use in the exact same way as a token generated by our SDKs](link to using section).